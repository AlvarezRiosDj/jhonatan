<!-- Inicio del contenido de languages -->

<style>
.kv-avatar .krajee-default.file-preview-frame,.kv-avatar .krajee-default.file-preview-frame:hover {
    margin: 0;
    padding: 0;
    border: none;
    box-shadow: none;
    text-align: center;
}
.kv-avatar {
    display: inline-block;
}
.kv-avatar .file-input {
    display: table-cell;
    width: 213px;
}
.kv-reqd {
    color: red;
    font-family: monospace;
    font-weight: normal;
}
#form-lang-edit{
  display: none;
}
</style>

<div class="card-box">

<div id="kv-avatar-errors-1" class="center-block" style="width:800px;display:none"></div>
<form class="form form-vertical" id="form-lang" enctype="multipart/form-data">
    <div class="row">
        <div class="col-sm-12 text-center">
            <div class="kv-avatar">
                <div class="file-loading">
                    <input id="img-lang" name="img-lang" type="file" required>
                </div>
            </div>
            <div class="kv-avatar-hint"><small>Select file < 1500 KB</small></div>
        </div>

    </div>
    <div class="row">
            <div class="col-sm-4">     
           
              <div class="form-group">
                <label for="name-lang">Idioma<span class="kv-reqd">*</span></label>
                <input type="text" class="form-control" name="name-lang" id="name-lang" maxlength="50" required>    </div>
           
          </div>
        <div class="col-sm-4">
          <div class="form-group">
                <label for="abbr-lang">Abreviación<span class="kv-reqd">*</span></label>
                <input type="text" class="form-control" name="abbr-lang" id="abbr-lang" maxlength="20" required>
              </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
                <label for="status-lang">Status<span class="kv-reqd">*</span></label>         
                <select name="status-lang" id="status-lang" class="form-control" required>
                  <option value="habilitado">habilitado</option>
                  <option value="deshabilitado">deshabilitado</option>
                </select>
              </div>
        </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <div class="form-group">
            <hr>
            <div class="text-right"> 
              <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
          </div>
      </div>
    </div>
</form>


<form class="form form-vertical" id="form-lang-edit" enctype="multipart/form-data">
    <div class="row">
        <div class="col-sm-12 text-center">
            <div class="kv-avatar">
                <div class="file-loading">
                    <input id="img-lang-edit" name="img-lang-edit" type="file">
                </div>
            </div>
            <div class="kv-avatar-hint"><small>Select file < 1500 KB</small></div>
        </div>
   
    </div>
    <div class="row">
      <div class="col-sm-4">
         <div class="form-group">
                <label for="name-lang-edit">Idioma<span class="kv-reqd">*</span></label>
                <input type="text" class="form-control" name="name-lang-edit" id="name-lang-edit" maxlength="50" required>
              </div>
      </div>
      <div class="col-sm-4">
        <div class="form-group">
                <label for="abbr-lang-edit">Abreviación<span class="kv-reqd">*</span></label>
                <input type="text" class="form-control" name="abbr-lang-edit" id="abbr-lang-edit" maxlength="20" readonly required>
              </div>
      </div>
      <div class="col-sm-4">
        <div class="form-group">
                <label for="status-lang-edit">Status<span class="kv-reqd">*</span></label>         
                <select name="status-lang-edit" id="status-lang-edit" class="form-control" required>
                  <option value="habilitado">habilitado</option>
                  <option value="deshabilitado">deshabilitado</option>
                </select>
              </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
         <div class="form-group">
            <hr>
            <div class="text-right"> 
              <input type="text" id="id-lang" hidden>
              <button type="submit" class="btn btn-primary">Guardar</button>
              <a href="#" id="cancel-edit" class="btn btn-primary">Cancelar</a>
            </div>
          </div>
      </div>
    </div>
</form>




</div>

<div class="card-box">
	<table id="table-lang" class="table table-bordered">
  <thead>
    <tr>
      <th>id</th>
      <th>Nombre</th>
      <th>Abreviacion</th>
      <th>image</th>
      <th>Status</th>
      <th>Fecha creacion</th>
      <th>Fecha actualizacion</th>
      <th>Acciones</th>      
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>




<!-- Fin del contenido de languages -->

<!-- Inicio de script para el languages -->

<script>
$("#img-lang").fileinput({
    language: "es",
    overwriteInitial: true,
    maxFileSize: 10000,
    showClose: false,
    showCaption: false,
    browseLabel: '',
    removeLabel: '',
    browseIcon: '<i class="fa fa-folder-open"></i>',
    removeIcon: '<i class="ion-close"></i>',
    removeTitle: 'Cancel or reset changes',
    elErrorContainer: '#kv-avatar-errors-1',
    msgErrorClass: 'alert alert-block alert-danger',
    defaultPreviewContent: '<i class="fa fa-font-awesome"></i>',
    layoutTemplates: {main2: '{preview} '  + ' {remove} {browse}'},
    allowedFileExtensions: ["jpg", "png", "gif"]
});

$("#img-lang-edit").fileinput({
    language:"es",
    overwriteInitial: true,
    maxFileSize: 10000,
    showClose: false,
    showCaption: false,
    browseLabel: '',
    removeLabel: '',
    browseIcon: '<i class="fa fa-folder-open"></i>',
    removeIcon: '<i class="ion-close"></i>',
    removeTitle: 'Cancel or reset changes',
    elErrorContainer: '#kv-avatar-errors-1',
    msgErrorClass: 'alert alert-block alert-danger',
    defaultPreviewContent: '<i class="fa fa-font-awesome"></i>',
    layoutTemplates: {main2: '{preview} '  + ' {remove} {browse}'},
    allowedFileExtensions: ["jpg", "png", "gif"]
});


</script>



<script>
	$(function(){

    var protocolo = window.location.protocol;
    var dominio = window.location.host;
    var urlcorta = protocolo+'//'+dominio;



      var table_lang = $('#table-lang').DataTable({
    ajax:{
      type:'GET',
      url:'/lang',
      dataSrc:''
    },
    columns:[
    {"data" : "id",visible:false},
    {"data": "name"},
    {"data": "abbreviated"},
    {"data" : "image",visible:false},
    {"data" : "status"},
    {"data" : "created_at"},
    {"data" : "updated_at"},
    {"defaultContent" : '<div class="btn-group" role="group">\
<button id="btnGroupDrop1" type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\
Acciones</button>\
<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">\
<a class="dropdown-item" href="#editar">Editar</a>\
<a class="dropdown-item" href="#eliminar">Eliminar</a>\
</div>\
</div>'}
    ],
    "order": [[0,"desc"]]
  });


  $('#table-lang').on('click','a[href="#editar"]',function(){
    var recuperaDatos = table_lang.row($(this).parents("tr")).data();

    $('#id-lang').val(recuperaDatos['id']);
    $('#name-lang-edit').val(recuperaDatos['name']);
    $('#abbr-lang-edit').val(recuperaDatos['abbreviated']);
    $('#status-lang-edit').val(recuperaDatos['status']);
    $("#img-lang-edit").fileinput('refresh',{
    defaultPreviewContent: '<img src="'+urlcorta+'/'+recuperaDatos['image']+'" class="img-fluid">',
    });
    $("#img-lang-edit").fileinput('clear');


    $('#form-lang-edit').css('display','block');
    $('#form-lang').css('display','none');

    $('#table-lang tr').css('background','white').css('color','black');
    $(this).parents('tr').css('background','#FF5733').css('color','white');

  });

  $('#table-lang').on('click','a[href="#eliminar"]',function(){
    alert("funcion actualmente deshabilitada");
  });


    $('#form-lang').validate({
      rules:{
        'img-lang':{required:true},
        'name-lang':{required:true},
        'abbr-lang':{required:true}
      },
      messages:{      
          'img-lang':{required:"Selecione una imagen"},
          'name-lang':{required:"Por favor ingrese el nombre del lenguaje"} ,
          'abbr-lang':{required:"Por favor ingrese la abrevicion del lenguaje"}   
      },
      submitHandler:function(form){
        var storeLang = new FormData($('#form-lang')[0]);
          $.ajax({
            url:'lang',
            headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            method:'POST',
            data:storeLang,
            processData:false,
            contentType:false,
          }).done(function(data){
            $.Notification.notify('success', 'bottom right', 'El lenguaje se agrego exitosamente');
            $('#form-lang')[0].reset();
            table_lang.ajax.reload();
          }).fail(function(data){

            if(data.status === 401){
              $(location).prop('pathname','');
            }

            if(data.status === 422){
              $errors = data.responseJSON;
              $.each($errors,function(key,value){
                  if(value['abbr-lang']!=undefined){
                      $.Notification.notify('error', 'bottom right', 'La abreviacion para este lenguaje ya esta en uso');
                  }
              });
            }


          });
      }
    });


      $('#form-lang-edit').validate({
        rules:{
        'name-lang-edit':{required:true},
        'abbr-lang-edit':{required:true}
      },
      messages:{      
          'name-lang-edit':{required:"Por favor ingrese el nombre del lenguaje"} ,
          'abbr-lang-edit':{required:"Por favor ingrese la abrevicion del lenguaje"}   
      },
      submitHandler:function(form){
        var updateLang = new FormData($('#form-lang-edit')[0]);
        updateLang.append('_method','PUT');
        var idLang = $('#id-lang').val()
          $.ajax({
            url:'lang/'+idLang,
            headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
            method:'POST',
            data:updateLang,
            processData:false,
            contentType:false
          }).done(function(data){
            $.Notification.notify('success', 'bottom right', 'El lenguaje se modifico correctamente');
            $('#form-lang-edit').css('display','none');
            $('#form-lang').css('display','block');
            table_lang.ajax.reload();
          });
      }
      });




    $('#cancel-edit').click(function(){
    $('#form-lang-edit').css('display','none');
    $('#form-lang').css('display','block');
    $('#table-lang tr').css('background','white').css('color','black');
 
    });



		//aqui va las funciones
	});
</script>

<!-- Fin de script para el languages -->