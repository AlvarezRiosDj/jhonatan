<!-- Inicio del contenido de tours -->


<link href="assets/admin/plugins/summernote/summernote-bs4.css" rel="stylesheet" />

<style>
.kv-avatar .krajee-default.file-preview-frame,.kv-avatar .krajee-default.file-preview-frame:hover {
margin: 0;
padding: 0;
border: none;
box-shadow: none;
text-align: center;
}
.kv-avatar {
display: inline-block;
}
.kv-avatar .file-input {
display: table-cell;
width: 213px;
}
.kv-reqd {
color: red;
font-family: monospace;
font-weight: normal;
}
i[id^='edit']{
    cursor: pointer;
}

#form-tour-edit{
  display: none;
}


#cancel-edit{
  color: white !important;
}
 #map,#map-edit {
        height: 400px;
        width: 100%;
       }
</style>




<form class="form form-vertical" id="form-tour" enctype="multipart/form-data">
	<div class="card-box">
  <div class="row">
    	<div class="col-sm-12 text-center">
            <div class="kv-avatar">
                <div class="file-loading">
                    <input id="input-img-tour" name="input-img-tour" type="file">
                </div>
            </div>
            <div class="kv-avatar-hint"><small>Select file < 1500 KB</small></div>
            <div id="kv-avatar-errors-1" class="center-block" style="width:800px;display:none"></div>
        </div>
    </div>
	<div class="row">
		<div class="col-sm-4">
          <div class="form-group">
            <label for="input-title-tour">Titulo </label>
            <input type="text" class="form-control" name="input-title-tour" id="nput-title-tour">
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label for="input-price-tour">Precio</label>
            <input type="number" class="form-control" name="input-price-tour" id="input-price-tour" step="any">
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label for="input-title-tour">Slider</label>          
            <select name="input-slider-tour" id="input-slider-tour" class="form-control">
            </select>
          </div>
        </div>
	</div>

	<div class="row">
		<div class="col-sm-12">
	   	<label for="input-short-description">Descripcion corta</label>
		<textarea name="input-short-description" id="input-short-description" cols="30" rows="5" class="form-control"></textarea>
		  </div>
		</div>
	
	<div class="row">
		<div class="col-sm-12">
		  <div class="form-group">
		   	<label for="input-description-tour">Descripcion Completa</label>
			<textarea name="input-description-tour" id="input-description-tour" class="summernote"></textarea>
		  </div>
		</div>
	</div>




</div>

<div class="card-box">
 <div class="row">
    <div class="col-sm-12">
       <div id="map"></div>
    </div>
    <div class="col-sm-6">
      <div class="form-group">
        <label for="">Latitud</label>
        <input type="text" name="latitud" id="latitud" class="form-control">
      </div>
    </div>
    <div class="col-sm-6">
      <label for="">Longitud</label>
      <input type="text" name="longitud" id="longitud" class="form-control">
    </div>
  </div>

</div>

	<div class="card-box">
	<h4>SEO</h4>
	<div class="row">
		<div class="col-sm-6">
			<div class="form-group">
            <label for="input-meta-description-tour">Meta description</label>
            <input type="text" class="form-control" name="input-meta-description-tour" id="input-meta-description-tour" >
          </div>
		</div>
		<div class="col-sm-6">
			<div class="form-group">
            <label for="input-meta-keywords-tour">Meta Keywords</label>
            <input type="text" class="form-control" name="input-meta-keywords-tour" id="input-meta-keywords-tour" >
          </div>
		</div>
	</div>
	</div>

	<div class="card-box">
	<div class="row">
		<div class="col-sm-4">
			<div class="form-group">
            <label for="input-lang-tour">Seleccione el  lenguaje</label>
           	<select name="input-lang-tour" id="input-lang-tour" class="form-control"></select>
          </div>
		</div>
		<div class="col-sm-4">
			<div class="form-group">
            <label for="input-categorie-tour">Seleccione la categoria </label>
           	<select name="input-categorie-tour" id="input-categorie-tour" class="form-control"></select>
          </div>
		</div>
		<div class="col-sm-4">
			<div class="form-group">
            <label for="input-status-tour">Estado</label>
           	<select name="input-status-tour" id="input-status-tour" class="form-control">
           		<option value="habilitado">habilitado</option>
           		<option value="deshabilitado">deshabilitado</option>
           	</select>
          </div>
		</div>
	
	</div>
  <div class="row">
    <div class="col-sm-8">
      <label for="">Slug (es la url amigable)</label>
      <input type="" name="input-slug-tour" class="form-control">
    </div>
    <div class="col-sm-4">
      <div class="form-group">
            <hr>
            <div class="text-right">
              <button type="submit" class="btn btn-primary">Guardar</button>        
            </div>
          </div>
    </div>
  </div>
		
	</div>

</form>






<form class="form form-vertical" id="form-tour-edit" enctype="multipart/form-data">
  <div class="card-box">
  <div class="row">
      <div class="col-sm-12 text-center">
            <div class="kv-avatar">
                <div class="file-loading">
                    <input id="input-img-tour-edit" name="input-img-tour-edit" type="file">
                </div>
            </div>
            <div class="kv-avatar-hint"><small>Select file < 1500 KB</small></div>
            <div id="kv-avatar-errors-1" class="center-block" style="width:800px;display:none"></div>
        </div>
    </div>
  <div class="row">
    <div class="col-sm-4">
          <div class="form-group">
            <label for="input-title-tour-edit">Titulo </label>
            <input type="text" class="form-control" name="input-title-tour-edit" id="input-title-tour-edit">
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label for="input-price-tour-edit">Precio</label>
            <input type="number" class="form-control" name="input-price-tour-edit" id="input-price-tour-edit" step="any">
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label for="input-title-tour-edit">Slider</label>          
            <select name="input-slider-tour-edit" id="input-slider-tour-edit" class="form-control">
            </select>
          </div>
        </div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <label for="input-short-description-edit">Descripcion corta</label>
    <textarea name="input-short-description-edit" id="input-short-description-edit" cols="30" rows="5" class="form-control"></textarea>
      </div>
    </div>
  
  <div class="row">
    <div class="col-sm-12">
      <div class="form-group">
        <label for="input-description-tour-edit">Descripcion Completa</label>
      <textarea name="input-description-tour-edit" id="input-description-tour-edit" class="summernote"></textarea>
      </div>
    </div>
  </div>




</div>



<div class="card-box">
 <div class="row">
    <div class="col-sm-12">
       <div id="map-edit"></div>
    </div>
    <div class="col-sm-6">
      <div class="form-group">
        <label for="">Latitud</label>
        <input type="text" name="latitud-edit" id="latitud-edit" class="form-control">
      </div>
    </div>
    <div class="col-sm-6">
      <label for="">Longitud</label>
      <input type="text" name="longitud-edit" id="longitud-edit" class="form-control">
    </div>
  </div>

</div>

  <div class="card-box">
  <h4>SEO</h4>
  <div class="row">
    <div class="col-sm-6">
      <div class="form-group">
            <label for="input-meta-description-tour-edit">Meta description</label>
            <input type="text" class="form-control" name="input-meta-description-tour-edit" id="input-meta-description-tour-edit" >
          </div>
    </div>
    <div class="col-sm-6">
      <div class="form-group">
            <label for="input-meta-keywords-tour">Meta Keywords</label>
            <input type="text" class="form-control" name="input-meta-keywords-tour-edit" id="input-meta-keywords-tour-edit" >
          </div>
    </div>
  </div>
  </div>

  <div class="card-box">
  <div class="row">
    <div class="col-sm-4">
      <div class="form-group">
            <label for="input-lang-tour-edit">Seleccione el  lenguaje</label>
            <select name="input-lang-tour-edit" id="input-lang-tour-edit" class="form-control"></select>
          </div>
    </div>
    <div class="col-sm-4">
      <div class="form-group">
            <label for="input-categorie-tour-edit">Seleccione la categoria </label>
            <select name="input-categorie-tour-edit" id="input-categorie-tour-edit" class="form-control"></select>
          </div>
    </div>
    <div class="col-sm-4">
      <div class="form-group">
            <label for="input-status-tour-edit">Estado</label>
            <select name="input-status-tour-edit" id="input-status-tour-edit" class="form-control">
              <option value="habilitado">habilitado</option>
              <option value="deshabilitado">deshabilitado</option>
            </select>
          </div>
    </div>
  
  </div>
  <div class="row">
    <div class="col-sm-8">
      <label for="">Slug (es la url amigable)</label>
      <input type="" name="input-slug-tour-edit" id="input-slug-tour-edit" class="form-control">
    </div>
    <div class="col-sm-4">
      <div class="form-group">
            <hr>
            <div class="text-right">
              <input type="text" id="idTour" hidden>
              <button type="submit" class="btn btn-primary">Guardar</button>
              <a class="btn btn-primary" id="cancel-edit">Cancelar</a>      
            </div>
          </div>
    </div>
  </div>
    
  </div>

</form>





<div class="card-box">
<table id="table-tour" class="table table-bordered">
<thead>
  <tr>
    <th>id</th>
    <th>Titulo</th>
    <th>Descripcio corta</th>
    <th>Email</th>
    <th>Privilegio</th>
    <th>Acciones</th>

  </tr>
</thead>
<tbody>
</tbody>
</table>
</div>



<!-- fin del contenido del users-->

<!-- inicio del scrip de users-->



<script>
      function initMap() {
        var uluru = {lat: -13.526943, lng: -71.967935};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: uluru
        });
        var marker = new google.maps.Marker({
          position: uluru,
          map: map,
          draggable:true
        });
          google.maps.event.addListener(marker,'dragend',function(event) {
            document.getElementById("latitud").value = this.getPosition().lat().toString();
            document.getElementById("longitud").value = this.getPosition().lng().toString();
         });

      }

    </script>
    
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBoHpdye5cuneO5ciw7Zb3TErgmYQn3QVU&callback=initMap"></script>



<!--form summernote-->
<script src="assets/admin/plugins/summernote/summernote-bs4.min.js"></script>
<script>
            jQuery(document).ready(function(){

                $('.summernote').summernote({
                    height: 350,                 // set editor height
                    minHeight: null,             // set minimum height of editor
                    maxHeight: null,             // set maximum height of editor
                    focus: false                 // set focus to editable area after initializing summernote
                });

                $('.inline-editor').summernote({
                    airMode: true
                });

            });
        </script>

<script>
	$("#input-img-tour").fileinput({
    overwriteInitial: true,
    maxFileSize: 10000,
    showClose: false,
    showCaption: false,
    browseLabel: '',
    removeLabel: '',
    browseIcon: '<i class="fa fa-folder-open"></i>',
	  removeIcon: '<i class="ion-close"></i>',
    removeTitle: 'Cancel or reset changes',
    elErrorContainer: '#kv-avatar-errors-1',
    msgErrorClass: 'alert alert-block alert-danger',
    defaultPreviewContent: '<i class="fa fa-file-photo-o"></i>',
    layoutTemplates: {main2: '{preview} ' + ' {remove} {browse}'},
    allowedFileExtensions: ["jpg", "png", "gif"]
});

$("#input-img-tour-edit").fileinput({
overwriteInitial: true,
maxFileSize: 10000,
showClose: false,
showCaption: false,
browseLabel: '',
removeLabel: '',
browseIcon: '<i class="fa fa-folder-open"></i>',
removeIcon: '<i class="ion-close"></i>',
removeTitle: 'Cancel or reset changes',
elErrorContainer: '#kv-avatar-errors-1',
msgErrorClass: 'alert alert-block alert-danger',
defaultPreviewContent: '<i class="fa fa-file-photo-o"></i>',
layoutTemplates: {main2: '{preview} ' + ' {remove} {browse}'},
allowedFileExtensions: ["jpg", "png", "gif"]
});



</script>


<script>
	$(function(){


    var protocolo = window.location.protocol;
    var dominio = window.location.host;
    var urlcorta = protocolo+'//'+dominio;



	//iniciamos el datatable

   var table_tour = $('#table-tour').DataTable({
    ajax:{
      type:'GET',
      url:'/turismo',
      dataSrc:''
    },
    columns:[
    {"data" : "categorie_id",visible:false},
    {"data": "name"},
    {"data" : "price"},
    {"data" : "status"},
    {"data" : "img",visible:false},
    {"defaultContent" : '<div class="btn-group" role="group">\
<button id="btnGroupDrop1" type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\
Acciones</button>\
<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">\
<a class="dropdown-item" href="#editar">Editar</a>\
<a class="dropdown-item" href="#eliminar">Eliminar</a>\
</div>\
</div>'}
    ],
order: [[1,"desc"]]
  });




    $('#table-tour').on('click','a[href="#editar"]',function(){
    var recuperaDatos = table_tour.row($(this).parents("tr")).data();



    $('#table-tour tr').css('background','white').css('color','black');
    $(this).parents('tr').css('background','#FF5733').css('color','white');

    $('#form-tour').css('display','none');
    $('#form-tour-edit').css('display','block');

    recuperarTour(recuperaDatos['id']);

  });









	//recuperamos los lenguages
	function recuperaLang(){
		$.ajax({
      url:'lang',
      method:'GET'
    }).done(function(data){
      cadenLang='';
      $(data).each(function(key,value){

        cadenLang+='<option value="'+value['id']+'">'+value['name']+'</option>'
      });
      $('#input-lang-tour').html(cadenLang);
      $('#input-lang-tour-edit').html(cadenLang);
    });
	}


  function recuperarSlider(){
    $.ajax({
      url:'img',
      method:'GET'
    }).done(function(data){
      var cadena='';
      $(data).each(function(key,value){     
        cadena+='<option value="'+value['id']+'">'+value['name']+'</option>';
      });
      $('#input-slider-tour').html(cadena);
      $('#input-slider-tour-edit').html(cadena);
    }).fail(function(){
      alert("ha ocurrido un error");
    });
  }
  recuperarSlider();

  //llamaos a la funcion para recuperar los lenguajes
  recuperaLang();


  //evento al cambiar el lenguaje para recuperar la categoria
    $('#input-lang-tour').change(function(){
       recuperaCategoria($(this).val());
    });


  //input-categorie-tour




	//recuperamos las categorias


	function recuperaCategoria(idLang){
      $.ajax({
      url:'/categorie',
      method:'GET',
      data:{id:idLang}
    }).done(function(data){
      var categorias='';
        for(ct in data.categorie){
          categorias+='<option value="'+data.categorie[ct].id+'">'+data.categorie[ct].name+'</option>';       
        }

        $('#input-categorie-tour').html(categorias);
        $('#input-categorie-tour-edit').html(categorias);
    }).fail(function(data){
        alert("ha ocurrido un error al recuperar");
    });
		  
	}

  recuperaCategoria(1);


  //validamos en formulario antes de enviarlo

  $('#form-tour').validate({
    rules:{
      'input-img-tour':{required:true},
      'input-title-tour':{required:true},
      'input-price-tour':{required:true},
      'input-short-description':{required:true},
      'input-description-tour':{required:true},
      'input-lang-tour':{required:true},
      'input-categorie-tour':{required:true},
      'input-status-tour':{required:true},
      'input-slug-tour':{required:true}
    },
    messages:{
      'input-img-tour':{required:"Seleccione una imagen"},
      'input-title-tour':{required:"Por favor ingrese el titulo"},
      'input-price-tour':{required:"Por favor ingrese el precio"},
      'input-short-description':{required:"Por favor ingrese una descripcion corta"},
      'input-description-tour':{required:"Por favor ingrese la descripcion completa"},
      'input-lang-tour':{required:"Por favor seleccione el lenguaje"},
      'input-categorie-tour':{required:"Por favor seleccione la categoria"},
      'input-status-tour':{required:"Por favor seleccione el estado"},
      'input-slug-tour':{required:"Por favor ingrese la url amigable"}
    },
    submitHandler:function(form){
      var storeTour = new FormData($('#form-tour')[0]);
        $.ajax({
          url:'turismo',
          headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
          method:'POST',
          data:storeTour,
          processData:false,
          contentType:false
        }).done(function(data){

          table_tour.ajax.reload();
           $('#form-tour')[0].reset();

           $('#input-description-tour').summernote('destroy');
           $('#input-description-tour').summernote({
                height: 350,                 // set editor height
                minHeight: null,             // set minimum height of editor
                maxHeight: null,             // set maximum height of editor
                focus: false                 // set focus to editable area after initializing summernote
            });


          $.Notification.notify('success', 'bottom right', 'Los datos fueron registrados exitosamente');
        }).fail(function(data){
          $.Notification.notify('error', 'bottom right', 'ha ocurrido un error');
        });
    }
  });


  $('#form-tour-edit').validate({
    rules:{
      
      'input-title-tour-edit':{required:true},
      'input-price-tour-edit':{required:true},
      'input-short-description-edit':{required:true},
      'input-description-tour-edit':{required:true},
      'input-lang-tour-edit':{required:true},
      'input-categorie-tour-edit':{required:true},
      'input-status-tour-edit':{required:true},
      'input-slug-tour-edit':{required:true}
    },
    messages:{

      'input-title-tour-edit':{required:"Por favor ingrese el titulo"},
      'input-price-tour-edit':{required:"Por favor ingrese el precio"},
      'input-short-description-edit':{required:"Por favor ingrese una descripcion corta"},
      'input-description-tour-edit':{required:"Por favor ingrese la descripcion completa"},
      'input-lang-tour-edit':{required:"Por favor seleccione el lenguaje"},
      'input-categorie-tour-edit':{required:"Por favor seleccione la categoria"},
      'input-status-tour-edit':{required:"Por favor seleccione el estado"},
      'input-slug-tour-edit':{required:"Por favor ingrese la url amigable"}
    },
    submitHandler:function(form){
      var updateTour = new FormData($('#form-tour-edit')[0]);
        updateTour.append('_method','PUT');
        var idTour = $('#idTour').val();
        $.ajax({
          url:'turismo/'+idTour,
          headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
          method:'POST',
          data:updateTour,
          processData:false,
          contentType:false
        }).done(function(data){
          table_tour.ajax.reload();
          $.Notification.notify('success', 'bottom right', 'Los datos fueron modificados exitosamente');
        }).fail(function(data){
          alert("ha ocurrido un error");
        });
    }
  });




function recuperarTour(idTour){

  $.ajax({
    url:'turismo/'+idTour,
    method:'GET'
  }).done(function(data){
    $(data).each(function(key,value){

      $('#idTour').val(value['id']);

      $("#input-img-tour-edit").fileinput('refresh',{
        defaultPreviewContent: '<img src="'+urlcorta+'/'+value['img']+'" class="img-fluid">',
        });
      $("#input-img-tour-edit").fileinput('clear');

      $('#input-title-tour-edit').val(value['name']);
      $('#input-price-tour-edit').val(value['price']);
      $('#input-short-description-edit').val(value['description_short']);
      $('#input-description-tour-edit').summernote('destroy');
      $('#input-description-tour-edit').val(value['description_complete']);
      $('#input-description-tour-edit').summernote({
            height: 350,                 // set editor height
            minHeight: null,             // set minimum height of editor
            maxHeight: null,             // set maximum height of editor
            focus: false                 // set focus to editable area after initializing summernote
        });
      $('#input-meta-description-tour-edit').val(value['meta_description']);
      $('#input-meta-keywords-tour-edit').val(value['meta_keywords']);
      $('#input-slug-tour-edit').val(value['slug']);
      $('#input-status-tour-edit').val(value['status']);
    });

    

    
 
  }).fail(function(data){
      alert("ha ocurrido un error");
  });
}





$('#cancel-edit').click(function(){
  alert("me hiciste click");
});




	});
</script>

<!-- Fin de script para el tours -->



