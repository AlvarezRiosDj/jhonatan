<style>
.kv-avatar .krajee-default.file-preview-frame,.kv-avatar .krajee-default.file-preview-frame:hover {
margin: 0;
padding: 0;
border: none;
box-shadow: none;
text-align: center;
}
.kv-avatar {
display: inline-block;
}
.kv-avatar .file-input {
display: table-cell;
width: 213px;
}
.kv-reqd {
color: red;
font-family: monospace;
font-weight: normal;
}

#countryFormEdit{
    display: none;
}



</style>
<div class="card-box">
    <h4 class="header-title m-t-0 m-b-30">Paises</h4>
    <!-- markup -->
    <!-- note: your server code `avatar_upload.php` will receive `$_FILES['avatar']` on form submission -->
    <!-- the avatar markup -->
    <form class="form form-vertical" id="countryForm" enctype="multipart/form-data">
        <div class="row">
            <div class="col-md-12 text-center">
                <div class="kv-avatar">
                    <div class="file-loading">
                        <input id="countryImage" name="countryImage" type="file" required>
                    </div>
                </div>
                <div class="kv-avatar-hint"><small>Select file < 1500 KB (W: 250px H: 250px)</small></div>
            </div>
            <div class="col-md-12 offset-md-4">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label for="input-name-categorie">Nombre<span class="kv-reqd">*</span></label>
                            <input type="text" id="countryName" name="countryName" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label for="input-description-categorie">Descripcion<span class="kv-reqd">*</span></label>
                            <textarea name="countryDescription" id="countryDescription" cols="30" rows="3" class='form-control' required></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <hr>
                    <div class="text-right">

                        <button type="submit" id="btnCountry" class="btn btn-primary">Guardar</a>

                    </div>
                </div>
            </div>
        </div>
    </form>
    <form class="form form-vertical" id="countryFormEdit" enctype="multipart/form-data">
    <div class="row">
        <div class="col-md-12 text-center">
            <div class="kv-avatar">
                <div class="file-loading">
                    <input id="countryImageEdit" name="countryImageEdit" type="file">
                </div>
            </div>
            <div class="kv-avatar-hint"><small>Select file < 1500 KB (W: 250px H: 250px)</small></div>
        </div>
        <div class="col-md-12 offset-md-4">
            <div class="row">
                <div class="col-sm-12">
                    <div class="form-group">
                        <label for="edit-name-categorie">Nombre<span class="kv-reqd">*</span></label>
                        <input type="text" id="countryNameEdit" name="countryNameEdit" class="form-control" required>
                    </div>
                </div>
                <div class="col-sm-12">
                    <div class="form-group">
                        <label for="edit-description-categorie">Descripcion<span class="kv-reqd">*</span></label>
                        <textarea name="countryDescriptionEdit" id="countryDescriptionEdit" cols="30" rows="3" class='form-control' required></textarea>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <hr>
                <div class="text-right">
                    <input type="text" id="countryId" name="countryId" hidden>
                    <button type="submit" id="btnCountryEdit" class="btn btn-primary">Actualizar</button>
                    <a id="btnCountryCancel" class="btn btn-primary">Cancelar</a>

                </div>
            </div>
        </div>
    </div>
</form>
    <div id="kv-avatar-errors-1" class="center-block" style="width:800px;display:none"></div>
</div>

<div class="card-box">
	<table id="table-country" class="table table-bordered">
  <thead>
    <tr>
      <th>id</th>
      <th>Name</th>
      <th>Description</th>
      <th>Acciones</th>

    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
    <!-- the fileinput plugin initialization -->
    <script>
    $("#countryImage").fileinput({
    language: "es",
    overwriteInitial: true,
    maxFileSize: 10000,
    showClose: false,
    showCaption: false,
    browseLabel: '',
    removeLabel: '',
    browseIcon: '<i class="fa fa-folder-open"></i>',
    removeIcon: '<i class="ion-close"></i>',
    removeTitle: 'Cancel or reset changes',
    elErrorContainer: '#kv-avatar-errors-1',
    msgErrorClass: 'alert alert-block alert-danger',
    defaultPreviewContent: '<i class="fa  fa-tag"></i>',
    layoutTemplates: {main2: '{preview} ' + ' {remove} {browse}'},
    allowedFileExtensions: ["jpg", "png", "gif"]
    });

    $("#countryImageEdit").fileinput({
    language: "es",
    overwriteInitial: true,
    maxFileSize: 10000,
    showClose: false,
    showCaption: false,
    browseLabel: '',
    removeLabel: '',
    browseIcon: '<i class="fa fa-folder-open"></i>',
    removeIcon: '<i class="ion-close"></i>',
    removeTitle: 'Cancel or reset changes',
    elErrorContainer: '#kv-avatar-errors-1',
    msgErrorClass: 'alert alert-block alert-danger',
    defaultPreviewContent: '<i class="fa  fa-tag"></i>',
    layoutTemplates: {main2: '{preview} ' + ' {remove} {browse}'},
    allowedFileExtensions: ["jpg", "png", "gif"]
    });

    </script>

    <script>

    $(function(){

      var protocolo = window.location.protocol;
      var dominio = window.location.host;
      var urlcorta = protocolo+'//'+dominio;

      var table_country = $('#table-country').DataTable({
            ajax:{
              type:'GET',
              url:'/country',
              dataSrc:''
            },
            columns:[
            {"data" : "id"},
            {"data": "name"},
            {"data": "description"},
            {"defaultContent" : '<div class="btn-group" role="group">\
        <button id="btnGroupDrop1" type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\
        Acciones</button>\
        <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">\
        <a class="dropdown-item" href="#editar">Editar</a>\
        <a class="dropdown-item" href="#eliminar">Eliminar</a>\
        </div>\
        </div>'}
            ],
        order: [[0,"desc"]]
      });


      $('#table-country').on('click','a[href="#eliminar"]',function(){
        var recuperaDatos = table_country.row($(this).parents("tr")).data();
        alert("funcion actualmente desabilitada");
      });

      $('#table-country').on('click','a[href="#editar"]',function(){
        var recuperaDatos = table_country.row($(this).parents("tr")).data();

        $('#countryId').val(recuperaDatos['id']);
        $('#countryNameEdit').val(recuperaDatos['name']);
        $('#countryDescriptionEdit').val(recuperaDatos['description']);

        $('#countryFormEdit').css('display','block');
        $('#countryForm').css('display','none');

        $("#countryImageEdit").fileinput('refresh',{
        defaultPreviewContent: '<img src="'+urlcorta+'/'+recuperaDatos['image']+'" class="img-fluid">',
        });
        $("#countryImageEdit").fileinput('clear');

        $('#table-country tr').css('background','white').css('color','black');
        $(this).parents('tr').css('background','#FF5733').css('color','white');

      });


      $('#countryForm').validate({
        rules:{
            'countryName':{required:true},
            'countryDescription':{required:true}
        },
        messages:{
            'countryName':{required:'Por favor ingrese el nombre'},
            'countryDescription':{required:'Por favor ingrese una descripcion'}
          },
          submitHandler:function(form){

            var storeCountry = new FormData($('#countryForm')[0]);

            $.ajax({
              url:'/country',
              headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
              method:'POST',
              data:storeCountry,
              processData:false,
              contentType:false,
            }).done(function(data){
              $.Notification.notify('success', 'bottom right', 'Pais Registrado correctamente');
              table_country.ajax.reload();
              $('#countryForm')[0].reset();
            }).fail(function(data){

                if(data.status === 401){
                            $(location).prop('pathname','/')
                        }

            });
          }
      });

      $('#countryFormEdit').validate({
         rules:{
             'countryNameEdit':{required:true},
             'countryDescriptionEdit':{required:true}
         },
         messages:{
             'countryNameEdit':{required:'Por favor ingrese un nombre'},
             'countryDescriptionEdit':{required:'Por favor ingrese una Descripción'}
           },
           submitHandler:function(form){

             var updateCountry = new FormData($('#countryFormEdit')[0]);
             updateCountry.append('_method','PUT');
             var countryId = $('#countryId').val();
             $.ajax({
               url:'/country/'+countryId,
               headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
               method:'POST',
               data:updateCountry,
               processData:false,
               contentType:false,
             }).done(function(data){

               $.Notification.notify('success', 'bottom right', 'País mofificado exitosamente');
               table_country.ajax.reload();
                $('#countryFormEdit').css('display','none');
                $('#countryForm').css('display','block')

             }).fail(function(data){

                   $.Notification.notify('error', 'bottom right', 'Ha ocurrido un error');

                 });
           }
       });

      $('#btnCountryCancel').click(function(){
        $('#countryFormEdit').css('display','none');
        $('#countryForm').css('display','block')
      });

    });
    </script>
    <!-- <script src='assets/admin/plugins/jstree/jstree.min.js'></script>
    <script src="assets/admin/pages/jquery.tree.js"></script>
    -->
